version: "3.9"

services:
  hybrid-proxy:
    image: node:20-alpine
    container_name: hybrid-proxy
    restart: unless-stopped

    working_dir: /app

    volumes:
      # Application code (read-write â€“ required for npm)
      - /home/alec/Projects/hybrid-llm-architecture:/app

      # AWS credentials (read-only)
      - /home/alec/.aws:/root/.aws:ro

    command: >
      sh -c "
        npm install --omit=dev &&
        node src/proxy/openaiProxyServer.js
      "

    ports:
      - "8787:8787"

    environment:
      CLOUD_ALLOWED: "true"
      OFFLINE_REQUIRED: "false"
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      AWS_SESSION_TOKEN: ${AWS_SESSION_TOKEN}
      AWS_REGION: "eu-west-1"

      BEDROCK_MODEL_ID: "anthropic.claude-3-sonnet"
      OLLAMA_BASE_URL: "http://<your_ihost>:11434"
      TRANSFER_PROMPT_PATH: "prompts/transfer/cloud_transfer_prompt_v1.md"

